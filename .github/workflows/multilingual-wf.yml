name: Auto-Detect and Deploy Project

on:
  workflow_call:
    inputs:
      version:
        description: 'The version to deploy'
        required: false
        type: string
        default: 'latest'
      runs-on:
        description: Platform to execute on
        type: string
        default: ubuntu-latest
        
      dotnet-version:
        description: Version of dotnet to use
        type: string
        default: 8.0.x
      
      project-folder:
        description: The folder containing the project to build
        type: string
        default: .

jobs:
  detect-and-deploy:
    name: Detect and deploy
    runs-on: ${{ inputs.runs-on }}
    defaults:
      run:
        working-directory: ${{ inputs.project-folder }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Detect project type
        id: detect_project
        run: |
          if [ -f "HelloWorldApp/HelloWorldApp.csproj" ]; then
            echo "Project type is .NET"
            echo "::set-output name=project_type::.NET"
          elif [ -f "angular.json" ]; then
            echo "Project type is Angular"
            echo "::set-output name=project_type::Angular"
          else
            echo "Unknown project type"
            exit 1
          fi
          
      - name: Deploy .NET
        if: ${{ steps.detect_project.outputs.project_type == 'NET' }}
        uses: missAnkita/Reusable-Workflows/.github/workflows/app-main.yml@main
        with:
          version: ${{ github.event.inputs.version }}
        #secrets:
        #  DEPLOYMENT_SECRET: ${{ secrets.DEPLOYMENT_SECRET }}

      - name: Deploy Angular
        if: ${{ steps.detect_project.outputs.project_type == 'Angular' }}
        uses: missAnkita/Reusable-Workflows/.github/workflows/deploy-angular.yml@main
        with:
          version: ${{ github.event.inputs.version }}
      #  secrets:
      #    DEPLOYMENT_SECRET: ${{ secrets.DEPLOYMENT_SECRET }}
